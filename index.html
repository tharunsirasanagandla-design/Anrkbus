<!DOCTYPE html>
<html>
<head>
    <title>Premium Bus Tracking</title>

    <style>
        body {
            margin: 0;
            font-family: Poppins, sans-serif;
            background: #0e0e0e;
            color: white;
        }

        /* Top Menu */
        #menu {
            display: flex;
            justify-content: center;
            gap: 20px;
            padding: 15px;
            background: rgba(255,255,255,0.06);
            backdrop-filter: blur(12px);
        }

        #menu button {
            padding: 10px 20px;
            border: none;
            background: #1e90ff;
            color: white;
            border-radius: 10px;
            cursor: pointer;
            font-size: 16px;
        }

        #menu button:hover {
            transform: scale(1.05);
        }

        /* Containers */
        #driverSection, #studentSection {
            display: none;
            text-align: center;
            padding: 20px;
        }

        input {
            width: 70%;
            padding: 15px;
            border-radius: 12px;
            border: none;
            margin-top: 15px;
            font-size: 18px;
            background: rgba(255,255,255,0.1);
            color: white;
        }

        button.startBtn {
            margin-top: 20px;
            padding: 15px 30px;
            border: none;
            border-radius: 12px;
            background: #00c8ff;
            color: black;
            font-size: 20px;
            cursor: pointer;
        }

        #map {
            width: 100%;
            height: calc(100vh - 120px);
            display: none;
        }
    </style>
</head>

<body>

    <!-- Top Menu -->
    <div id="menu">
        <button onclick="openStudent()">Student</button>
        <button onclick="openDriver()">Driver</button>
    </div>

    <!-- STUDENT VIEW -->
    <div id="studentSection">
        <h2>ðŸšŒ Live Bus Tracking</h2>
        <div id="map"></div>
    </div>

    <!-- DRIVER VIEW -->
    <div id="driverSection">
        <h2>Driver Panel</h2>
        <p>Enter your Bus Code to start sharing location</p>

        <input id="busCode" placeholder="Enter bus code (ex: 599)">
        <br>
        <button class="startBtn" onclick="startSharing()">Start Sharing</button>
    </div>

    <!-- FIREBASE + LOGIC -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
        import { getDatabase, ref, set, onValue } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-database.js";

        const firebaseConfig = {
            apiKey: "AIzaSyD-DUMMY-KEY",
            authDomain: "bus-tracking-pro.firebaseapp.com",
            databaseURL: "https://bus-tracking-pro-default-rtdb.firebaseio.com",
            projectId: "bus-tracking-pro",
            storageBucket: "bus-tracking-pro.appspot.com",
            messagingSenderId: "191919191919",
            appId: "1:191919191919:web:2919291929ee"
        };

        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);

        let map;
        let markers = {};

        /* STUDENT MAP */
        function initMap() {
            map = new google.maps.Map(document.getElementById("map"), {
                zoom: 14,
                center: { lat: 17.123, lng: 79.123 }
            });

            const busesRef = ref(db, "buses");

            onValue(busesRef, (snapshot) => {
                const buses = snapshot.val();
                if (!buses) return;

                Object.keys(buses).forEach(busId => {
                    const data = buses[busId];

                    if (!markers[busId]) {
                        markers[busId] = new google.maps.Marker({
                            position: { lat: data.lat, lng: data.lng },
                            map: map,
                            label: busId
                        });
                    } else {
                        markers[busId].setPosition({ lat: data.lat, lng: data.lng });
                    }
                });
            });
        }

        window.initMap = initMap;

        /* DRIVER SHARE */
        window.startSharing = function () {
            const code = document.getElementById("busCode").value;

            const busCodes = {
                "599": "Bus1",
                "888": "Bus2",
                "777": "Bus3"
            };

            if (!busCodes[code]) {
                alert("Invalid Code!");
                return;
            }

            const busId = busCodes[code];

            navigator.geolocation.watchPosition(pos => {
                set(ref(db, "buses/" + busId), {
                    lat: pos.coords.latitude,
                    lng: pos.coords.longitude
                });
            });

            alert("Sharing location for " + busId);
        };
    </script>

    <!-- GOOGLE MAPS -->
    <script async src="https://maps.googleapis.com/maps/api/js?key=YOUR_MAP_KEY&callback=initMap"></script>

    <!-- MENU LOGIC -->
    <script>
        function openStudent() {
            document.getElementById("studentSection").style.display = "block";
            document.getElementById("driverSection").style.display = "none";
            document.getElementById("map").style.display = "block";
        }

        function openDriver() {
            document.getElementById("studentSection").style.display = "none";
            document.getElementById("driverSection").style.display = "block";
            document.getElementById("map").style.display = "none";
        }
    </script>

</body>
</html>
